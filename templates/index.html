<!DOCTYPE html>
<html lang="en">
<head>

  <!-- Basic Page Needs
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <meta charset="utf-8">
  <title>Watch Together</title>
  <meta name="description" content="">
  <meta name="author" content="">

  <!-- Mobile Specific Metas
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- FONT
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <link href="//fonts.googleapis.com/css?family=Raleway:400,300,600" rel="stylesheet" type="text/css">

  <!-- CSS
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css" integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt" crossorigin="anonymous">
  <link rel="stylesheet" href="../static/css/normalize.css">
  <link rel="stylesheet" href="../static/css/skeleton.css">
  <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.css">

  <!-- JS
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/socket.io/1.3.6/socket.io.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>

  <script type="text/javascript" src="/static/js/main.js"></script>
  <script type="text/javascript">
    // Initialize socket events
    socket = io.connect('http://' + document.domain + ':' + location.port);

    socket.on('connect', function() {
        socket.emit('joined');
    });

    socket.on('new-user-sync', function(id) {
        window.onload = function() {
            console.log(id);
            player.loadVideoById(id);
            player.playVideo();
        }
    });

    socket.on('server-skip', function(time) {
        player.seekTo(time);
        player.playVideo();
    });

    // Play / Pause ------------------------->
    socket.on('server-play', function(time) {
        console.log("Received play socket")
        player.seekTo(time);
        player.playVideo();
    });
    socket.on('server-pause', function(time) {
        console.log("Received pause socket")
        player.seekTo(time);
        player.pauseVideo();
    });

    controlPlay = function() {
        socket.emit('client-play', {time: player.getCurrentTime()});
    };
    controlPause = function() {
        socket.emit('client-pause', {time: player.getCurrentTime()});
    };
    // -------------------------------------->

    // Process playing new video ------------>
    socket.on('server-play-new', function(data) {
        player.loadVideoById(data["id"]);
        for (history in data["history"]) {
          $('#history-list').append('<tr>'+history+'</tr>');
        }
        player.seekTo(0);
        player.playVideo();
    });

    controlPlayNew = function() {
        socket.emit('client-play-new', {url: $("#yt-url").val()});
    };
  </script>

  <!-- Favicon
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <link rel="icon" type="image/png" href="../static/images/favicon.png">

</head>
<body>

  <!-- Primary Page Layout
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <div class="container">
    <div class="row">
      <div class="two-thirds column" style="margin-top: 5%">
        <h5 id="page-title"></h5>
        <h6 id="page-author" style="margin-top: -4%"></h6>
        <div id="video-placeholder"></div>
        <script src="https://www.youtube.com/iframe_api"></script>
        <input type="range" class="u-full-width" id="progress-bar"></input>
        <script>
          $('#progress-bar').on('mouseup touchend', function (e) {
              // Calculate the new time for the video.
              // new time in seconds = total duration in seconds * ( value of range input / 100 )
              var newTime = player.getDuration() * (e.target.value / 100);
              socket.emit('client-skip', {time: newTime});
          });
        </script>
        <br />
        <button onclick="controlPlay()"><i class="fas fa-play"></i></button>
        <button onclick="controlPause()"><i class="fas fa-pause"></i></button>
        <input type="range" id="volume-slider" alt="Change volume" value="100"></input>
        <script>
          $("#volume-slider").change(function() {
            player.setVolume($("#volume-slider").val());
          });  
        </script>
        <input type="text" class="u-full-width" id="yt-url" placeholder="Enter Youtube URL Here"></input>
        <script>
          $('#yt-url').on("keydown", function(event) {
            if (event.which == 13) {
              controlPlayNew();
            }
          });
        </script>
      </div>
    <div class="one-third column" style="margin-top: 5%">
      <table id="history-list" class="u-full-width">
        <thead>
          <tr>t</tr>
        </thead>
      </table>
    </div>
  </div>

<!-- End Document
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
</body>
</html>
